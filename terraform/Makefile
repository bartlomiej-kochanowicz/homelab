.PHONY: init plan apply destroy output validate format

# Variables
TFVARS_FILE := modules/cloudflare/variables.tfvars

init: ## Initialize Terraform (download providers and modules)
	@echo "ğŸ”§ Initializing Terraform..."
	terraform init

init-upgrade: ## Initialize and upgrade providers
	@echo "ğŸ”§ Initializing Terraform with provider upgrade..."
	terraform init -upgrade

plan: ## Show planned changes
	@echo "ğŸ“‹ Planning Terraform changes..."
	terraform plan -var-file=$(TFVARS_FILE)

apply: ## Apply Terraform configuration
	@echo "ğŸš€ Applying Terraform configuration..."
	terraform apply -var-file=$(TFVARS_FILE)

destroy: ## Destroy all Terraform resources
	@echo "ğŸ’£ Destroying Terraform resources..."
	@echo "âš ï¸  This will delete the tunnel, DNS records, and Access policies!"
	terraform destroy -var-file=$(TFVARS_FILE)

output: ## Show all outputs
	@echo "ğŸ“¤ Terraform outputs:"
	@terraform output

validate: ## Validate Terraform configuration
	@echo "âœ… Validating Terraform configuration..."
	terraform validate

format: ## Format Terraform files
	@echo "ğŸ¨ Formatting Terraform files..."
	terraform fmt -recursive
